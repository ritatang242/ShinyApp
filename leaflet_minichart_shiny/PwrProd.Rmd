---
title: "法國各地區發電方式"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    theme: default
    css: JH.css
    social: menu
    source_code: embed 
    logo: nsysu48.png
    favicon: nsysu48.png
runtime: shiny
---

```{r}
# options(shiny.usecairo = FALSE)
pacman::p_load(dplyr,leaflet,leaflet.minicharts,flexdashboard)
data("eco2mix")
load("regions.rda")

# Remove data for the whole country
prodRegions <- eco2mix %>% filter(area != "France")

# Production columns
prodCols <- names(prodRegions)[6:13]

# Create base map
tilesURL = paste0(
  "http://server.arcgisonline.com/ArcGIS/rest/services/Canvas/",
  "World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}")

basemap <- leaflet(width = "100%", height = "400px") %>%
  addTiles(tilesURL) %>%
  addPolylines(data = regions, weight = 1, color = "brown")
```

Input {.sidebar data-width=250}
-------------------------------------
```{r}
h6("Monthly electric production of french regions from 2013 to 2017"); hr()
selectInput("prods", "Select productions", choices = prodCols, multiple = TRUE)
selectInput("type", "Chart type", choices = c("bar","pie", "polar-area", "polar-radius"))
checkboxInput("labels", "Show values")
```
<br>

<img src="cm_nsysu.png" alt="CM.NSYSU" width="80" height="80" align="left"><br>
<h6>[中山大學商業大數據平台](https://bap.cm.nsysu.edu.tw/)</h6>
<h6>[計量經濟互助學習小組](https://www.facebook.com/groups/2198167973823697/?epa=SEARCH_BOX)</h6>

Row1 {data-height="85%"}
-------------------------------------
### Chart {data-width=76%}
```{r}
# create a ui interaction:
leafletOutput("map")

# render the ui:
output$map = renderLeaflet({
  basemap %>% addMinicharts(
    prodRegions$lng, prodRegions$lat, layerId = prodRegions$area,
    width = 45, height = 45
    ) })

observe({
  if (length(input$prods) == 0) { data <- 1 } else 
    { data <- prodRegions[, input$prods] }
  maxValue <- max(as.matrix(data))

  leafletProxy("map") %>% updateMinicharts(
    prodRegions$area, chartdata = data, maxValues = maxValue,
    type = ifelse(length(input$prods) < 2, "polar-area", input$type),
    time = prodRegions$month, showLabels = input$labels
    )
})


```

Row2 {.tabset data-height="15%"}
-------------------------------------
### `r "\U1F691"` <b><span style="color:blue">說明</span></b>

### <b>`⚠ 注意事項`</b>
<h6>⚠ 這個程式是數據分析的教材</h6>


